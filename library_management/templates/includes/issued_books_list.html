{% if doc.get("issued_books") %}
<div class="issued-books-container">
	<style>
		.issued-books-container {
			background: #f8f9fa;
			border: 1px solid #dee2e6;
			border-radius: 8px;
			padding: 15px;
			margin: 10px 0;
		}


		.issued-books-table {
			width: 100%;
			border-collapse: collapse;
			background: white;
			border-radius: 6px;
			overflow: hidden;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}

		.issued-books-table th {
			background: #e9ecef;
			color: #495057;
			font-weight: 600;
			padding: 12px;
			text-align: left;
			font-size: 14px;
			border-bottom: 2px solid #dee2e6;
		}

		.issued-books-table td {
			padding: 10px 12px;
			border-bottom: 1px solid #e9ecef;
			vertical-align: top;
		}

		.issued-books-table tr:last-child td {
			border-bottom: none;
		}

		.issued-books-table tr:hover {
			background: #f8f9fa;
		}

		.book-link {
			color: #0d6efd;
			text-decoration: none;
			font-weight: 500;
		}

		.book-link:hover {
			text-decoration: underline;
			color: #0b5ed7;
		}

		.transaction-link {
			color: #198754;
			text-decoration: none;
			font-size: 12px;
		}

		.transaction-link:hover {
			text-decoration: underline;
			color: #157347;
		}

		.due-status {
			padding: 4px 8px;
			border-radius: 4px;
			font-size: 12px;
			font-weight: 500;
		}

		.due-overdue {
			background: #f8d7da;
			color: #721c24;
		}

		.due-upcoming {
			background: #fff3cd;
			color: #856404;
		}

		.due-normal {
			color: #155724;
		}

		.no-books {
			color: #6c757d;
			font-style: italic;
			text-align: center;
			padding: 30px;
			background: white;
			border-radius: 6px;
		}

		.book-count {
			color: #495057;
			font-size: 14px;
			margin-bottom: 10px;
		}
	</style>

	{% if doc.issued_books %}
	<table class="issued-books-table">
		<thead>
			<tr>
				<th>Book Title</th>
				<th>ISBN</th>
				<th>Issue Date</th>
				<th>Due Date</th>
				<th>Status</th>
				<th>Transaction</th>
			</tr>
		</thead>
		<tbody>
			{% for book in doc.issued_books %}
			<tr>
				<td>
					<a href="/app/book/{{ book.book }}" class="book-link" target="_blank">
						{{ book.book_title or book.book }}
					</a>
				</td>
				<td>{{ book.isbn or '-' }}</td>
				<td>{{ frappe.format_date(book.transaction_date) if book.transaction_date else '-'
					}}</td>
				<td>{{ frappe.format_date(book.due_date) if book.due_date else '-' }}</td>
				<td>
					{% if book.due_date %}
					{% set today = frappe.utils.getdate() %}
					{% set due_date = frappe.utils.getdate(book.due_date) %}
					{% if due_date < today %} <span class="due-status due-overdue">OVERDUE</span>
						{% elif (due_date - today).days <= 3 %} <span
							class="due-status due-upcoming">DUE SOON</span>
							{% else %}
							<span class="due-status due-normal">ACTIVE</span>
							{% endif %}
							{% else %}
							<span class="due-status due-normal">ACTIVE</span>
							{% endif %}
				</td>
				<td>
					<a href="/app/book-transaction/{{ book.transaction_name }}"
						class="transaction-link" target="_blank">
						{{ book.transaction_name }}
					</a>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	{% else %}
	<div class="no-books">
		No books currently issued to this member
	</div>
	{% endif %}
</div>
{% else %}
<div class="issued-books-container">
	<div class="no-books">
		No books currently issued to this member
	</div>
</div>
{% endif %}